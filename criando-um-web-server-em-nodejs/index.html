<!DOCTYPE html>
<html lang="pt">
  <head>
    
      <title>
        Criando um web server em Nodejs ::
        Na minha m√°quina funciona
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Introdu√ß√£o Quando voc√™ visualiza uma p√°gina web no seu browser, seu computador est√° fazendo uma requisi√ß√£o para um outro computador (üåà Internet), a resposta dessa requisi√ß√£o normalmente √© uma p√°gina HTML. Na real as coisas n√£o s√£o t√£o simples assim, tem bastante coisa que rola no meio do caminho para isso funcionar, mas normalmente quem devolve essa resposta para seu browser √© um web server. Caso queira se aprofundar tem esse artigo como um bom ponto de partida que explica como a web funciona."
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://jerielverissimo.github.io/criando-um-web-server-em-nodejs/" />





<link rel="stylesheet" href="https://jerielverissimo.github.io/assets/style.css" />

<link rel="stylesheet" href="https://jerielverissimo.github.io/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="https://jerielverissimo.github.io/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="https://jerielverissimo.github.io/img/favicon.png" />


<link href="https://jerielverissimo.github.io/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://jerielverissimo.github.io/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://jerielverissimo.github.io/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://jerielverissimo.github.io/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://jerielverissimo.github.io/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://jerielverissimo.github.io/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Criando um web server em Nodejs"/>
<meta name="twitter:description" content="Introdu√ß√£o Quando voc√™ visualiza uma p√°gina web no seu browser, seu computador est√° fazendo uma requisi√ß√£o para um outro computador (üåà Internet), a resposta dessa requisi√ß√£o normalmente √© uma p√°gina HTML. Na real as coisas n√£o s√£o t√£o simples assim, tem bastante coisa que rola no meio do caminho para isso funcionar, mas normalmente quem devolve essa resposta para seu browser √© um web server. Caso queira se aprofundar tem esse artigo como um bom ponto de partida que explica como a web funciona."/>



<meta property="og:title" content="Criando um web server em Nodejs" />
<meta property="og:description" content="Introdu√ß√£o Quando voc√™ visualiza uma p√°gina web no seu browser, seu computador est√° fazendo uma requisi√ß√£o para um outro computador (üåà Internet), a resposta dessa requisi√ß√£o normalmente √© uma p√°gina HTML. Na real as coisas n√£o s√£o t√£o simples assim, tem bastante coisa que rola no meio do caminho para isso funcionar, mas normalmente quem devolve essa resposta para seu browser √© um web server. Caso queira se aprofundar tem esse artigo como um bom ponto de partida que explica como a web funciona." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jerielverissimo.github.io/criando-um-web-server-em-nodejs/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-29T03:03:41-03:00" />
<meta property="article:modified_time" content="2021-08-29T03:03:41-03:00" /><meta property="og:site_name" content="Na minha m√°quina funciona" />







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Na minha m√°quina funciona</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/sobre">Sobre</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/sobre">Sobre</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Criando um web server em Nodejs</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2021-08-29
        </span>

        
          
        
      

      


      
    </div>

    

    

    <div class="post-content">
      
      <h2 id="introdu√ß√£o">Introdu√ß√£o</h2>
<p>Quando voc√™ visualiza uma p√°gina web no seu browser, seu computador est√° fazendo uma requisi√ß√£o para um outro computador (üåà Internet), a resposta dessa requisi√ß√£o normalmente √© uma p√°gina HTML.
Na real as coisas n√£o s√£o t√£o simples assim, tem bastante coisa que rola no meio do caminho para isso funcionar, mas normalmente quem devolve essa resposta para seu browser √© um web server.
Caso queira se aprofundar tem esse
<strong><a href="https://developer.mozilla.org/pt-BR/docs/Learn/Getting_started_with_the_web/How_the_Web_works">artigo</a></strong>
como um bom ponto de partida que explica como a web funciona.</p>
<h2 id="web-server">Web server</h2>
<p>E √© sobre isso que vamos falar hoje neste post, vamos criar um servidor web bem simples usando o <em><strong>Nodejs</strong></em>.</p>
<p>A comunica√ß√£o entre seu browser e o <em>servidor</em> (quem responde suas requisi√ß√µes üòâ), √© feita por meio do protocolo <em><strong>HTTP</strong></em>,
e o nodejs j√° traz em sua biblioteca padr√£o um m√≥dulo chamado <em><strong>http</strong></em> que adivinha o que ele faz? Isso mesmo, abstrair pra gente as funcionalidades deste protocolo.</p>
<h3 id="primeiro-passo----criando-um-servidor-http-b√°sico">Primeiro passo &ndash; Criando um servidor HTTP b√°sico</h3>
<p>Vamos come√ßar criando uma pasta para nosso projeto e dentro dela crie um arquivo js que ser√° usado para criar o servidor.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mkdir basic-server
$ <span style="color:#fff;font-weight:bold">cd</span> basic-server
$ touch server.js
</code></pre></div><p>Abra o arquivo server.js que a gente acabou de criar com seu editor preferido e come√ße importando o m√≥dulo http.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#fff;font-weight:bold">const</span> http = require(<span style="color:#0ff;font-weight:bold">&#39;http&#39;</span>);
</code></pre></div><p>Para nosso web server funcionar precisamos falar para ele ficar escutando de algum lugar as requisi√ß√µes.
Ent√£o passamos para ele um endere√ßo e uma porta, que nesse caso podemos usar o endere√ßo <em><strong>localhost</strong></em>  e a porta <em><strong>8080</strong></em>
j√° que vamos rodar em nossa pr√≥pria m√°quina.</p>
<p>Usamos localhost porque √© um apelido para nosso pr√≥prio computador, poderiamos usar o IP 127.0.0.1 que √© a tradu√ß√£o
de localhost, caso queira entender melhor como o <em><strong>DNS</strong></em> funciona tem esse
<em><strong><a href="https://developer.mozilla.org/pt-BR/docs/Learn/Common_questions/What_is_a_domain_name">artigo</a></strong></em>
que pode lhe ajudar.</p>
<p>Assim toda requisi√ß√£o que chegar nesse endere√ßo e porta, nosso Sistema Operacional magicamente ir√° redirecionar
para nosso web server e ir√° devolver a resposta do nosso web server para quem fez a requisi√ß√£o.</p>
<p>Bom voltando para o nosso arquivo server.js, cria logo abaixo da importa√ß√£o do m√≥dulo http o endere√ßo e porta para usarmos depois.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> host = <span style="color:#0ff;font-weight:bold">&#39;localhost&#39;</span>;
<span style="color:#fff;font-weight:bold">const</span> port = <span style="color:#ff0;font-weight:bold">8080</span>;
</code></pre></div><p>Vamos adicionar uma fun√ß√£o que ser√° respons√°vel por gerenciar as requisi√ß√µes que nosso servidor for recebendo.
Essa fun√ß√£o recebe como argumentos dois objetos, um de <em><strong>request</strong></em> e outro de <em><strong>response</strong></em>, que podemos chamar elas de <em><strong>req</strong></em> e <em><strong>res</strong></em>.
Como no nosso caso queremos devolver uma resposta, vamos utilizar o objeto de <em>response</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> listener = <span style="color:#fff;font-weight:bold">function</span> (req, res) {
  res.writeHead(<span style="color:#ff0;font-weight:bold">200</span>);
  res.end(<span style="color:#0ff;font-weight:bold">&#34;Hello, from my server :)&#34;</span>);
};
</code></pre></div><p>No protocolo HTTP quando fazemos uma requisi√ß√£o obtemos uma resposta com um status, que indica como essa requisi√ß√£o
foi tratada pelo servidor. Vamos focar por enquanto em uma requisi√ß√£o do tipo <em><strong>GET</strong></em>.</p>
<p>Com o m√©todo <em><strong>writeHead</strong></em> passamos o status da resposta, que nesse caso √© 200 que vai indicar que tudo ocorreu com sucesso.
J√° o m√©todo <em><strong>end</strong></em> devolve de fato a resposta HTTP com tudo o que passamos pra ele.</p>
<p>Apenas com essa fun√ß√£o n√£o conseguimos fazer muita coisa, quem de fato vai fazer a m√°gica √© a lib http, basta a gente
criar um servidor usando a lib passando nossa fun√ß√£o que acabamos de criar como argumento, que ela ser√° usada toda vez que esse servidor
receber uma requisi√ß√£o.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> server = http.createServer(listener);
server.listen(port, host, () =&gt; {
  console.log(<span style="color:#0ff;font-weight:bold">`Server is running on http://</span><span style="color:#0ff;font-weight:bold">${</span>host<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">:</span><span style="color:#0ff;font-weight:bold">${</span>port<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">`</span>);
});
</code></pre></div><p>O que o m√©todo <em><strong>listen</strong></em> faz √© atrelar o servidor que foi criado a um endere√ßo e porta,
ele recebe tamb√©m uma <em>callback</em> que √© executada quando tudo est√° pronto.</p>
<p>Bom com isso basta abrir um terminal e rodar nosso script pra subir nosso servidorzinho.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ node server.js
</code></pre></div><p>Voc√™ vai ver o log da callback de sucesso que passamos para o m√©todo listen indicando que nosso servidor
est√° pronto para receber requisi√ß√µes.</p>
<pre><code>Server is running on http://localhost:8080
</code></pre><p>Para testarmos basta fazer uma requisi√ß√£o <strong>GET</strong> usando o <em><strong>cURL</strong></em>, caso prefira pode abrir o mesmo endere√ßo no seu browser.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl http://localhost:8080
</code></pre></div><p>E voc√™ vai ver a mensagem que nosso servidorzinho enviou üòé.</p>
<pre><code>Hello, from my server :)
</code></pre><h3 id="segundo-passo----servindo-uma-p√°gina-html">Segundo passo &ndash; Servindo uma p√°gina HTML</h3>
<p>S√≥ com isso n√£o √© suficiente para criarmos uma aplica√ß√£o mais complexa, podemos por exemplo querer enviar uma p√°gina <strong>HTML</strong>
para o browser.</p>
<p>Para isso usamos os cabe√ßalhos, que saÃÉÃÅo atributos que passamos nas requests/responses no protocolo HTTP.
Usando nosso exemplo, vamos alterar a fun√ß√£o listener que criamos para adicionar na resposta um <em><strong>header</strong></em>  que vai indicar
que estamos enviando como resposta um arquivo HTML, e mudamos tamb√©m o conte√∫do para um html v√°lido.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> listener = <span style="color:#fff;font-weight:bold">function</span> (req, res) {
  res.setHeader(<span style="color:#0ff;font-weight:bold">&#39;Content-Type&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;text/html&#39;</span>);
  res.writeHead(<span style="color:#ff0;font-weight:bold">200</span>);
  res.end(<span style="color:#0ff;font-weight:bold">&#34;&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is an HTML file&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#34;</span>);
};
...
</code></pre></div><p>Agora se voc√™ subir de novo o servidor e abrir o endere√ßo no browser ir√° visualizar a p√°gina HTML que enviamos, da mesma forma via terminal.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl http://localhost:8080
&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is an HTML file&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div><h3 id="terceiro-passo----servindo-um-json">Terceiro passo &ndash; Servindo um JSON</h3>
<p>Um outro formato que √© bem comum √© o <strong>JSON</strong>, que √© bastante utilizado quando se envolve <em><strong>APIs</strong></em>.
Caso queira suportar esse formato basta mudar novamente o listener para:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> listener = <span style="color:#fff;font-weight:bold">function</span> (req, res) {
  res.setHeader(<span style="color:#0ff;font-weight:bold">&#39;Content-Type&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;application/json&#39;</span>);
  res.writeHead(<span style="color:#ff0;font-weight:bold">200</span>);
  res.end(<span style="color:#0ff;font-weight:bold">&#39;{ &#34;message&#34;: &#34;valid JSON object&#34; }&#39;</span>);
};
...
</code></pre></div><p>E novamente&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl http://localhost:8080
{ <span style="color:#0ff;font-weight:bold">&#34;message&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;valid JSON object&#34;</span> }
</code></pre></div><h3 id="quarto-passo----recebendo-um-post">Quarto passo &ndash; Recebendo um POST</h3>
<p>At√© agora lidamos apenas com requisi√ß√µes do tipo <strong>GET</strong>, outro tipo que √© bastante comum s√£o as do tipo <strong>POST</strong>.
Elas d√£o um pouco mais de trabalho para usarmos, mas n√£o √© nenhuma coisa de outro mundo.</p>
<p>O m√≥dulo http do nodejs usa as <em><strong>Streams</strong></em> para gerenciar as requests e responses, ou seja tudo √© feito em um fluxo
cont√≠nuo de forma <strong>ass√≠ncrona</strong> para que, por exemplo, uma requisi√ß√£o que demore mais para ser respondida n√£o bloqueia o servidor de receber
outras requisi√ß√µes que v√£o chegando ao mesmo tempo.</p>
<p>Por isso uma requisi√ß√£o por exemplo n√£o chega pronta com tudo de uma vez, ela chega em peda√ßos, precisamos ir <em>&ldquo;montando&rdquo;</em> ela
primeiro como se fosse pe√ßas de um <em><strong>Lego</strong></em>, antes de conseguir usar ela.</p>
<p>J√° que uma requisi√ß√£o do tipo <strong>POST</strong> possui um <em><strong>body</strong></em> como conte√∫do, vamos precisar primeiro montar esse body √† medida que ele vai chegando.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> listener = <span style="color:#fff;font-weight:bold">function</span> (req, res) {
  <span style="color:#fff;font-weight:bold">let</span> body = <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>; <span style="color:#007f7f">// buffer para salvar os dados da requisi√ß√£o
</span><span style="color:#007f7f"></span>  req.on(<span style="color:#0ff;font-weight:bold">&#39;data&#39;</span>, (chunk) =&gt; {
    body += chunk; <span style="color:#007f7f">// os dados v√£o chegando em peda√ßos e n√£o tudo de uma vez
</span><span style="color:#007f7f"></span>  });
  ...
};
...
</code></pre></div><p>Criamos uma vari√°vel chamada <em>body</em> para receber o conte√∫do da requisi√ß√£o, e passamos ela na callback para ir incrementando seu conte√∫do.
Essa callback a gente passa no evento <strong>data</strong>, que √© etapa da requisi√ß√£o que recebe um peda√ßo do seu conte√∫do.</p>
<p>Ent√£o toda vez que chegar um pedacinho dos dados, um evento do tipo <em><strong>data</strong></em> √© emitido e essa callback que passamos √© executada.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> listener = <span style="color:#fff;font-weight:bold">function</span> (req, res) {
  <span style="color:#fff;font-weight:bold">let</span> body = <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>; <span style="color:#007f7f">// buffer para salvar os dados da requisi√ß√£o
</span><span style="color:#007f7f"></span>  req.on(<span style="color:#0ff;font-weight:bold">&#39;data&#39;</span>, (chunk) =&gt; {
    body += chunk; <span style="color:#007f7f">// os dados v√£o chegando em peda√ßos e n√£o tudo de uma vez
</span><span style="color:#007f7f"></span>  });

  <span style="color:#007f7f">// quando todos os peda√ßos da requisi√ß√£o chegaram :)
</span><span style="color:#007f7f"></span>  req.on(<span style="color:#0ff;font-weight:bold">&#39;end&#39;</span>, () =&gt; {
    console.log(body); <span style="color:#007f7f">// mostra o conte√∫do que recebemos da requisi√ß√£o
</span><span style="color:#007f7f"></span>    res.writeHead(<span style="color:#ff0;font-weight:bold">200</span>, { <span style="color:#0ff;font-weight:bold">&#39;Content-Type&#39;</span>: <span style="color:#0ff;font-weight:bold">&#39;application/json&#39;</span> });
    res.end(<span style="color:#0ff;font-weight:bold">&#39;Request received&#39;</span>); <span style="color:#007f7f">// devolve resposta para o cliente
</span><span style="color:#007f7f"></span>  });
};
...
</code></pre></div><p>Quando n√£o tem mais dados para receber da requisi√ß√£o, ou seja j√° recebemos todos os &ldquo;peda√ßos&rdquo; dela e conseguimos montar o &ldquo;lego&rdquo;,
um evento do tipo <strong>end</strong> √© emitido e com isso passamos pra ele uma callback
que nesse caso vamos apenas printar o conte√∫do que recebemos que √© o body da requisi√ß√£o <strong>POST</strong>
e devolver uma resposta para o cliente.</p>
<p>Vamos testar mandando um json para o servidor.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl --location --request POST <span style="color:#0ff;font-weight:bold">&#39;localhost:8080&#39;</span> <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>--header <span style="color:#0ff;font-weight:bold">&#39;Content-Type: application/json&#39;</span> <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>--data-raw <span style="color:#0ff;font-weight:bold">&#39;{ &#34;message&#34;: &#34;JSON from client.&#34; }&#39;</span>

Request received
</code></pre></div><p>E o servidor vai printar o conte√∫do da requisi√ß√£o.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ node server.js
{ <span style="color:#0ff;font-weight:bold">&#34;message&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;JSON from client.&#34;</span> }
</code></pre></div><h3 id="quinto-passo----lidando-com-rotas">Quinto passo &ndash; Lidando com rotas</h3>
<p>Por √∫ltimo, quando lidamos com um servidor web √© bem comum fazermos requisi√ß√µes via <strong>rotas</strong> assim podemos dividir nosso
servidor em partes menores, e cada rota ser respons√°vel por uma funcionalide.</p>
<p>Por exemplo podemos ter uma rota chamada <strong>/add</strong> para adicionar um usu√°rio e outra rota <strong>/users</strong> para listar os usu√°rios adicionados.
A rota /add vai ser uma rota do tipo <strong>POST</strong>  e rota /users vai ser uma rota do tipo <strong>GET</strong>.</p>
<p>Vamos mover todo conte√∫do da nossa fun√ß√£o listener para uma outra chamada de post.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> post = <span style="color:#fff;font-weight:bold">function</span> (req, res) {
  <span style="color:#fff;font-weight:bold">let</span> body = <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>; <span style="color:#007f7f">// buffer para salvar os dados da requisi√ß√£o
</span><span style="color:#007f7f"></span>  req.on(<span style="color:#0ff;font-weight:bold">&#39;data&#39;</span>, (chunk) =&gt; {
    body += chunk; <span style="color:#007f7f">// os dados v√£o chegando em peda√ßos e n√£o tudo de uma vez
</span><span style="color:#007f7f"></span>  });

  <span style="color:#007f7f">// quando todos os peda√ßos da requisi√ß√£o chegaram :)
</span><span style="color:#007f7f"></span>  req.on(<span style="color:#0ff;font-weight:bold">&#39;end&#39;</span>, () =&gt; {
    console.log(body); <span style="color:#007f7f">// mostra o conte√∫do que recebemos da requisi√ß√£o
</span><span style="color:#007f7f"></span>    res.writeHead(<span style="color:#ff0;font-weight:bold">200</span>, { <span style="color:#0ff;font-weight:bold">&#39;Content-Type&#39;</span>: <span style="color:#0ff;font-weight:bold">&#39;application/json&#39;</span> });
    res.end(<span style="color:#0ff;font-weight:bold">&#39;Request received&#39;</span>); <span style="color:#007f7f">// devolve resposta para o cliente
</span><span style="color:#007f7f"></span>  });
};
...
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> listener = <span style="color:#fff;font-weight:bold">function</span> (req, res) {};
...
</code></pre></div><p>Agora no nosso listener, vamos olhar para a url da requisi√ß√£o para decidirmos as rotas.
Caso a url seja diferente da que estamos esperando, devolvemos um <em><strong>404</strong></em>.</p>
<p>Na rota /add chamamos a fun√ß√£o post que criamos para tratar a requisi√ß√£o desta rota.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> listener = <span style="color:#fff;font-weight:bold">function</span> (req, res) {
  <span style="color:#fff;font-weight:bold">switch</span> (req.url) {
    <span style="color:#fff;font-weight:bold">case</span> <span style="color:#0ff;font-weight:bold">&#39;/add&#39;</span>:
      post(req, res);
      <span style="color:#fff;font-weight:bold">break</span>;
    <span style="color:#fff;font-weight:bold">case</span> <span style="color:#0ff;font-weight:bold">&#39;/users&#39;</span>:
      <span style="color:#fff;font-weight:bold">break</span>;
    <span style="color:#fff;font-weight:bold">default</span>:
      res.setHeader(<span style="color:#0ff;font-weight:bold">&#39;Content-Type&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;application/json&#39;</span>);
      res.writeHead(<span style="color:#ff0;font-weight:bold">404</span>);
      res.end(JSON.stringify({ error: <span style="color:#0ff;font-weight:bold">&#39;Resource not found&#39;</span> }));
  }
};
...
</code></pre></div><p>Para adicionar um usu√°rio vamos simplesmente adicionar o conte√∫do da request em array, ent√£o nossa fun√ß√£o <em>post vai</em> fica assim:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> users = [];

<span style="color:#fff;font-weight:bold">const</span> post = <span style="color:#fff;font-weight:bold">function</span> (req, res) {
  <span style="color:#fff;font-weight:bold">let</span> body = <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>; <span style="color:#007f7f">// buffer para salvar os dados da requisi√ß√£o
</span><span style="color:#007f7f"></span>  req.on(<span style="color:#0ff;font-weight:bold">&#39;data&#39;</span>, (chunk) =&gt; {
    body += chunk; <span style="color:#007f7f">// os dados v√£o chegando em peda√ßos e n√£o tudo de uma vez
</span><span style="color:#007f7f"></span>  });

  <span style="color:#007f7f">// quando todos os peda√ßos da requisi√ß√£o chegaram :)
</span><span style="color:#007f7f"></span>  req.on(<span style="color:#0ff;font-weight:bold">&#39;end&#39;</span>, () =&gt; {
    <span style="color:#fff;font-weight:bold">const</span> user = JSON.parse(body);
    users.push(user);

    <span style="color:#007f7f">// tamb√©m podemos adicionar ao mesmo tempo o status e os headers
</span><span style="color:#007f7f"></span>    res.writeHead(<span style="color:#ff0;font-weight:bold">200</span>, { <span style="color:#0ff;font-weight:bold">&#39;Content-Type&#39;</span>: <span style="color:#0ff;font-weight:bold">&#39;application/json&#39;</span> });
    res.end(<span style="color:#0ff;font-weight:bold">&#39;User added&#39;</span>); <span style="color:#007f7f">// devolve resposta para o cliente
</span><span style="color:#007f7f"></span>  });
};
...
</code></pre></div><p>Agora para listar os usu√°rios adicionados simplesmente criamos uma fun√ß√£o chamada get que devolve o array de usu√°rios.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> get = <span style="color:#fff;font-weight:bold">function</span> (req, res) {
  res.setHeader(<span style="color:#0ff;font-weight:bold">&#39;Content-Type&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;application/json&#39;</span>);
  res.writeHead(<span style="color:#ff0;font-weight:bold">200</span>);
  res.end(JSON.stringify(users));
};
...
</code></pre></div><p>E por fim adicionamos a chamada desse get na rota de /users no nosso listener.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#fff;font-weight:bold">const</span> listener = <span style="color:#fff;font-weight:bold">function</span> (req, res) {
  <span style="color:#fff;font-weight:bold">switch</span> (req.url) {
    <span style="color:#fff;font-weight:bold">case</span> <span style="color:#0ff;font-weight:bold">&#39;/add&#39;</span>:
      post(req, res);
      <span style="color:#fff;font-weight:bold">break</span>;
    <span style="color:#fff;font-weight:bold">case</span> <span style="color:#0ff;font-weight:bold">&#39;/users&#39;</span>:
      get(req, res);
      <span style="color:#fff;font-weight:bold">break</span>;
    <span style="color:#fff;font-weight:bold">default</span>:
      res.setHeader(<span style="color:#0ff;font-weight:bold">&#39;Content-Type&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;application/json&#39;</span>);
      res.writeHead(<span style="color:#ff0;font-weight:bold">404</span>);
      res.end(JSON.stringify({ error: <span style="color:#0ff;font-weight:bold">&#39;Resource not found&#39;</span> }));
  }
};
...
</code></pre></div><p>Assim conseguimos adicionar usu√°rios.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl --location --request POST <span style="color:#0ff;font-weight:bold">&#39;localhost:8080/add&#39;</span> <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>--header <span style="color:#0ff;font-weight:bold">&#39;Content-Type: application/json&#39;</span> <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>--data-raw <span style="color:#0ff;font-weight:bold">&#39;{ &#34;name&#34;: &#34;Jo√£o&#34; }&#39;</span>

User added
$ curl --location --request POST <span style="color:#0ff;font-weight:bold">&#39;localhost:8080/add&#39;</span> <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>--header <span style="color:#0ff;font-weight:bold">&#39;Content-Type: application/json&#39;</span> <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span>--data-raw <span style="color:#0ff;font-weight:bold">&#39;{ &#34;name&#34;: &#34;Maria&#34; }&#39;</span>

User added
</code></pre></div><p>E visualizar os usu√°rios adicionados.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl --location --request GET <span style="color:#0ff;font-weight:bold">&#39;localhost:8080/users&#39;</span>

[{<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;Jo√£o&#34;</span>},{<span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;Maria&#34;</span>}]
</code></pre></div><p>E assim terminamos esse longo artigo, espero que tenha aprendido algo com ele, caso queira ver o arquivo final criei este
<a href="https://gist.github.com/jerielverissimo/c84d24fb66bf813d056d8cef0aff270e">gist</a>.</p>
<p>Claro que com isso que vimos hoje, talvez voc√™ n√£o sai criando uma aplica√ß√£o grande,
j√° que √© um pouco mais &ldquo;baixo&rdquo; n√≠vel, e normalmente usamos um framework para fazer esse tipo tarefas,
por√©m com esse conte√∫do podemos tentar criar nosso mini-framework ao estilo express. que adivinha ser√° nosso pr√≥ximo desafio hehe.</p>
<h4 id="refer√™ncias">Refer√™ncias</h4>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-web-server-in-node-js-with-the-http-module">How To Create a Web Server in Node.js with the HTTP Module</a></p>
<p><a href="https://stackoverflow.com/questions/51071321/nodejs-server-receiving-post-request">NodeJS server receiving POST request</a></p>
<p><a href="https://www.tutorialspoint.com/nodejs/nodejs_streams.htm">Node.js - Streams</a></p>

    </div>
    
      
    

    
      
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "na-minha-maquina-funciona" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Na minha m√°quina funciona</span
    >
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span
          >¬© 2021 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span
        >
        <span
          >Theme created by
          <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span
        >
      </div>
    
  </div>
</footer>

<script src="https://jerielverissimo.github.io/assets/main.js"></script>
<script src="https://jerielverissimo.github.io/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
